"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const EventBus_1 = require("../EventBus");
const Run_1 = require("./Run");
let isRestarting = false;
exports.default = ({ eventBus, command, }) => {
    const run = new Run_1.Run({ command });
    run.eventBus.on(run.Events.Started, () => {
        if (isRestarting) {
            isRestarting = false;
        }
        eventBus.emit(EventBus_1.ChildEvents.Started);
    });
    run.eventBus.on(run.Events.Stopped, (code) => {
        if (isRestarting) {
            run.eventBus.emit(run.Events.Start);
        }
        else if (!run.isRunning()) {
            eventBus.emit(EventBus_1.ChildEvents.Stopped, code);
        }
    });
    // Set main event emitter events
    eventBus.on(EventBus_1.ChildEvents.Start, () => {
        run.start();
    });
    eventBus.on(EventBus_1.ChildEvents.Restart, () => {
        isRestarting = true;
        run.eventBus.emit(run.Events.Stop);
    });
    // Pass kill request to execution eventbus
    eventBus.on(EventBus_1.ChildEvents.Stop, () => run.eventBus.emit(run.Events.Stop));
};
